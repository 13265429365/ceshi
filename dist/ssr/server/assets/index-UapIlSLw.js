import{b as n,u as g,i as h,N as u,o as d}from"../server-entry.js";import{reactive as l,toRefs as P}from"vue";import{useRouter as y,useRoute as I}from"vue-router";import{useI18n as w}from"vue-i18n/dist/vue-i18n.runtime.node.mjs";const S=()=>n.get("/captcha/create",{showLoading:!0}),K=r=>n.post("/login",r,{showLoading:!0}),C=r=>n.post("/register",r,{showLoading:!0}),v=()=>{const r=y(),i=I(),s=g(),o=h(),c=w(),e=l({baseURL:"http://192.168.5.135:3040",showTextPassword:{password:!1,cmfPassword:!1,securityKey:!1,cmfSecurityKey:!1},onlineInfo:{icon:"",link:""},loginParams:{username:"",password:"",captchaId:"",captchaVal:""},registerParams:{username:"",password:"",cmfPassword:"",captchaId:"",captchaVal:"",email:"",telephone:"",securityKey:"",cmfSecurityKey:"",code:i.query.code?i.query.code:""},currentCountry:{}}),a=()=>{S().then(t=>{e.loginParams.captchaId=t,e.registerParams.captchaId=t})},f=()=>{K(e.loginParams).then(async t=>{s.updateUserInfo(t.userInfo),s.updateToken(t.token),r.push({name:"HomeIndex"})}).catch(()=>{a()})},m=()=>{if(o.setting.register.showCmfPass&&e.registerParams.password!==e.registerParams.cmfPassword)return u("negative",c.t("twoPasswordsAreDifferent")),!1;if(o.setting.register.showCmfSecurityKey&&e.registerParams.securityKey!==e.registerParams.cmfSecurityKey)return u("negative",c.t("twoSecretKeyAreDifferent")),!1;e.registerParams.telephone=e.currentCountry.code+"|"+e.registerParams.telephone,o.setting.register.showTelephone,C(e.registerParams).then(t=>{s.updateUserInfo(t.userInfo),s.updateToken(t.token),r.push({name:"HomeIndex"})}).catch(()=>{a()})},p=()=>{d().then(t=>{e.onlineInfo=t})};return{...P(e),refreshCaptchaFunc:a,userLoginFunc:f,userRegisterFunc:m,onlineInfoFunc:p}};export{v as u};
