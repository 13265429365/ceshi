import{c as me,i as He,e as _e,bo as Te,aM as $e,g as pe,aN as Qe,a as z,h as B,aO as Ve,r as q,aB as Oe,aj as je,aw as Xe,a1 as Ge,a2 as Ye,ah as Ke,w as Je,T as Ze,bp as et,bq as tt,br as at,ag as Fe,p as rt,H as nt,N as we,bs as it,n as ot,aJ as lt,bt as st,A as ut,bu as xe,bv as ct,b2 as dt,_ as ft,s as Se,u as vt,v as Be,B as ke,t as ht,y as mt,x as pt,b3 as gt,Z as bt}from"./index-BAN5Iapo.js";import{b as yt,h as Ue}from"./format-DyQxkAtJ.js";const _t=me({name:"QUploaderAddTrigger",setup(){const e=He(Te,_e);return e===_e&&console.error("QUploaderAddTrigger needs to be child of QUploader"),e}}),Ft={...$e,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},ve=50,De=2*ve,Le=De*Math.PI,wt=Math.round(Le*1e3)/1e3,xt=me({name:"QCircularProgress",props:{...Ft,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:r}){const{proxy:{$q:n}}=pe(),t=Qe(e),i=z(()=>{const v=(n.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(n.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-v}deg)`:`rotate3d(0, 0, 1, ${v-90}deg)`}}),o=z(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),f=z(()=>De/(1-e.thickness/2)),d=z(()=>`${f.value/2} ${f.value/2} ${f.value} ${f.value}`),u=z(()=>yt(e.value,e.min,e.max)),c=z(()=>e.max-e.min),p=z(()=>e.thickness/2*f.value),_=z(()=>{const v=(e.max-u.value)/c.value,a=e.rounded===!0&&u.value<e.max&&v<.25?p.value/2*(1-v/.25):0;return Le*v+a});function k({thickness:v,offset:a,color:m,cls:y,rounded:g}){return B("circle",{class:"q-circular-progress__"+y+(m!==void 0?` text-${m}`:""),style:o.value,fill:"transparent",stroke:"currentColor","stroke-width":v,"stroke-dasharray":wt,"stroke-dashoffset":a,"stroke-linecap":g,cx:f.value,cy:f.value,r:ve})}return()=>{const v=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&v.push(B("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:ve-p.value/2,cx:f.value,cy:f.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&v.push(k({cls:"track",thickness:p.value,offset:0,color:e.trackColor})),v.push(k({cls:"circle",thickness:p.value,offset:_.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const a=[B("svg",{class:"q-circular-progress__svg",style:i.value,viewBox:d.value,"aria-hidden":"true"},v)];return e.showValue===!0&&a.push(B("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},r.default!==void 0?r.default():[B("div",u.value)])),B("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:t.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:u.value},Ve(r.internal,a))}}});function Y(e,r,n,t){const i=[];return e.forEach(o=>{t(o)===!0?i.push(o):r.push({failedPropValidation:n,file:o})}),i}function le(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),je(e)}const St={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Bt=["rejected"];function kt({editable:e,dnd:r,getFileInput:n,addFilesToQueue:t}){const{props:i,emit:o,proxy:f}=pe(),d=q(null),u=z(()=>i.accept!==void 0?i.accept.split(",").map(s=>(s=s.trim(),s==="*"?"*/":(s.endsWith("/*")&&(s=s.slice(0,s.length-1)),s.toUpperCase()))):null),c=z(()=>parseInt(i.maxFiles,10)),p=z(()=>parseInt(i.maxTotalSize,10));function _(s){if(e.value)if(s!==Object(s)&&(s={target:null}),s.target!==null&&s.target.matches('input[type="file"]')===!0)s.clientX===0&&s.clientY===0&&Oe(s);else{const R=n();R&&R!==s.target&&R.click(s)}}function k(s){e.value&&s&&t(null,s)}function v(s,R,A,P){let b=Array.from(R||s.target.files);const x=[],S=()=>{x.length!==0&&o("rejected",x)};if(i.accept!==void 0&&u.value.indexOf("*/")===-1&&(b=Y(b,x,"accept",h=>u.value.some(U=>h.type.toUpperCase().startsWith(U)||h.name.toUpperCase().endsWith(U))),b.length===0))return S();if(i.maxFileSize!==void 0){const h=parseInt(i.maxFileSize,10);if(b=Y(b,x,"max-file-size",U=>U.size<=h),b.length===0)return S()}if(i.multiple!==!0&&b.length!==0&&(b=[b[0]]),b.forEach(h=>{h.__key=h.webkitRelativePath+h.lastModified+h.name+h.size}),P===!0){const h=A.map(U=>U.__key);b=Y(b,x,"duplicate",U=>h.includes(U.__key)===!1)}if(b.length===0)return S();if(i.maxTotalSize!==void 0){let h=P===!0?A.reduce((U,O)=>U+O.size,0):0;if(b=Y(b,x,"max-total-size",U=>(h+=U.size,h<=p.value)),b.length===0)return S()}if(typeof i.filter=="function"){const h=i.filter(b);b=Y(b,x,"filter",U=>h.includes(U))}if(i.maxFiles!==void 0){let h=P===!0?A.length:0;if(b=Y(b,x,"max-files",()=>(h++,h<=c.value)),b.length===0)return S()}if(S(),b.length!==0)return b}function a(s){le(s),r.value!==!0&&(r.value=!0)}function m(s){je(s),(s.relatedTarget!==null||Xe.is.safari!==!0?s.relatedTarget!==d.value:document.elementsFromPoint(s.clientX,s.clientY).includes(d.value)===!1)===!0&&(r.value=!1)}function y(s){le(s);const R=s.dataTransfer.files;R.length!==0&&t(null,R),r.value=!1}function g(s){if(r.value===!0)return B("div",{ref:d,class:`q-${s}__dnd absolute-full`,onDragenter:le,onDragover:le,onDragleave:m,onDrop:y})}return Object.assign(f,{pickFiles:_,addFiles:k}),{pickFiles:_,addFiles:k,onDragover:a,onDragleave:m,processFiles:v,getDndNode:g,maxFilesNumber:c,maxTotalSizeNumber:p}}function Re(e){return(e*100).toFixed(2)+"%"}const Ut={...Ge,...St,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},Ie=[...Bt,"start","finish","added","removed"];function Rt(e,r){const n=pe(),{props:t,slots:i,emit:o,proxy:f}=n,{$q:d}=f,u=Ye(t,d);function c(l,w,C){if(l.__status=w,w==="idle"){l.__uploaded=0,l.__progress=0,l.__sizeLabel=Ue(l.size),l.__progressLabel="0.00%";return}if(w==="failed"){f.$forceUpdate();return}l.__uploaded=w==="uploaded"?l.size:C,l.__progress=w==="uploaded"?1:Math.min(.9999,l.__uploaded/l.size),l.__progressLabel=Re(l.__progress),f.$forceUpdate()}const p=z(()=>t.disable!==!0&&t.readonly!==!0),_=q(!1),k=q(null),v=q(null),a={files:q([]),queuedFiles:q([]),uploadedFiles:q([]),uploadedSize:q(0),updateFileStatus:c,isAlive:()=>Ke(n)===!1},{pickFiles:m,addFiles:y,onDragover:g,onDragleave:s,processFiles:R,getDndNode:A,maxFilesNumber:P,maxTotalSizeNumber:b}=kt({editable:p,dnd:_,getFileInput:ie,addFilesToQueue:oe});Object.assign(a,e({props:t,slots:i,emit:o,helpers:a,exposeApi:l=>{Object.assign(a,l)}})),a.isBusy===void 0&&(a.isBusy=q(!1));const x=q(0),S=z(()=>x.value===0?0:a.uploadedSize.value/x.value),h=z(()=>Re(S.value)),U=z(()=>Ue(x.value)),O=z(()=>p.value===!0&&a.isUploading.value!==!0&&(t.multiple===!0||a.queuedFiles.value.length===0)&&(t.maxFiles===void 0||a.files.value.length<P.value)&&(t.maxTotalSize===void 0||x.value<b.value)),F=z(()=>p.value===!0&&a.isBusy.value!==!0&&a.isUploading.value!==!0&&a.queuedFiles.value.length!==0);rt(Te,Z);const D=z(()=>"q-uploader column no-wrap"+(u.value===!0?" q-uploader--dark q-dark":"")+(t.bordered===!0?" q-uploader--bordered":"")+(t.square===!0?" q-uploader--square no-border-radius":"")+(t.flat===!0?" q-uploader--flat no-shadow":"")+(t.disable===!0?" disabled q-uploader--disable":"")+(_.value===!0?" q-uploader--dnd":"")),L=z(()=>"q-uploader__header"+(t.color!==void 0?` bg-${t.color}`:"")+(t.textColor!==void 0?` text-${t.textColor}`:""));Je(a.isUploading,(l,w)=>{w===!1&&l===!0?o("start"):w===!0&&l===!1&&o("finish")});function I(){t.disable===!1&&(a.abort(),a.uploadedSize.value=0,x.value=0,ne(),a.files.value=[],a.queuedFiles.value=[],a.uploadedFiles.value=[])}function T(){t.disable===!1&&K(["uploaded"],()=>{a.uploadedFiles.value=[]})}function Q(){K(["idle","failed"],({size:l})=>{x.value-=l,a.queuedFiles.value=[]})}function K(l,w){if(t.disable===!0)return;const C={files:[],size:0},j=a.files.value.filter(E=>l.indexOf(E.__status)===-1?!0:(C.size+=E.size,C.files.push(E),E.__img!==void 0&&window.URL.revokeObjectURL(E.__img.src),!1));C.files.length!==0&&(a.files.value=j,w(C),o("removed",C.files))}function J(l){t.disable||(l.__status==="uploaded"?a.uploadedFiles.value=a.uploadedFiles.value.filter(w=>w.__key!==l.__key):l.__status==="uploading"?l.__abort():x.value-=l.size,a.files.value=a.files.value.filter(w=>w.__key!==l.__key?!0:(w.__img!==void 0&&window.URL.revokeObjectURL(w.__img.src),!1)),a.queuedFiles.value=a.queuedFiles.value.filter(w=>w.__key!==l.__key),o("removed",[l]))}function ne(){a.files.value.forEach(l=>{l.__img!==void 0&&window.URL.revokeObjectURL(l.__img.src)})}function ie(){return v.value||k.value.getElementsByClassName("q-uploader__input")[0]}function oe(l,w){const C=R(l,w,a.files.value,!0),j=ie();j!=null&&(j.value=""),C!==void 0&&(C.forEach(E=>{if(a.updateFileStatus(E,"idle"),x.value+=E.size,t.noThumbnails!==!0&&E.type.toUpperCase().startsWith("IMAGE")){const H=new Image;H.src=window.URL.createObjectURL(E),E.__img=H}}),a.files.value=a.files.value.concat(C),a.queuedFiles.value=a.queuedFiles.value.concat(C),o("added",C),t.autoUpload===!0&&a.upload())}function X(){F.value===!0&&a.upload()}function W(l,w,C){if(l===!0){const j={type:"a",key:w,icon:d.iconSet.uploader[w],flat:!0,dense:!0};let E;return w==="add"?(j.onClick=m,E=Z):j.onClick=C,B(we,j,E)}}function Z(){return B("input",{ref:v,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:t.accept,multiple:t.multiple===!0?"multiple":void 0,capture:t.capture,onMousedown:Oe,onClick:m,onChange:oe})}function ee(){return i.header!==void 0?i.header(M):[B("div",{class:"q-uploader__header-content column"},[B("div",{class:"flex flex-center no-wrap q-gutter-xs"},[W(a.queuedFiles.value.length!==0,"removeQueue",Q),W(a.uploadedFiles.value.length!==0,"removeUploaded",T),a.isUploading.value===!0?B(Fe,{class:"q-uploader__spinner"}):null,B("div",{class:"col column justify-center"},[t.label!==void 0?B("div",{class:"q-uploader__title"},[t.label]):null,B("div",{class:"q-uploader__subtitle"},[U.value+" / "+h.value])]),W(O.value,"add"),W(t.hideUploadBtn===!1&&F.value===!0,"upload",a.upload),W(a.isUploading.value,"clear",a.abort)])])]}function te(){return i.list!==void 0?i.list(M):a.files.value.map(l=>B("div",{key:l.__key,class:"q-uploader__file relative-position"+(t.noThumbnails!==!0&&l.__img!==void 0?" q-uploader__file--img":"")+(l.__status==="failed"?" q-uploader__file--failed":l.__status==="uploaded"?" q-uploader__file--uploaded":""),style:t.noThumbnails!==!0&&l.__img!==void 0?{backgroundImage:'url("'+l.__img.src+'")'}:null},[B("div",{class:"q-uploader__file-header row flex-center no-wrap"},[l.__status==="failed"?B(nt,{class:"q-uploader__file-status",name:d.iconSet.type.negative,color:"negative"}):null,B("div",{class:"q-uploader__file-header-content col"},[B("div",{class:"q-uploader__title"},[l.name]),B("div",{class:"q-uploader__subtitle row items-center no-wrap"},[l.__sizeLabel+" / "+l.__progressLabel])]),l.__status==="uploading"?B(xt,{value:l.__progress,min:0,max:1,indeterminate:l.__progress===0}):B(we,{round:!0,dense:!0,flat:!0,icon:d.iconSet.uploader[l.__status==="uploaded"?"done":"clear"],onClick:()=>{J(l)}})])]))}Ze(()=>{a.isUploading.value===!0&&a.abort(),a.files.value.length!==0&&ne()});const M={};for(const l in a)et(a[l])===!0?tt(M,l,()=>a[l].value):M[l]=a[l];return Object.assign(M,{upload:X,reset:I,removeUploadedFiles:T,removeQueuedFiles:Q,removeFile:J,pickFiles:m,addFiles:y}),at(M,{canAddFiles:()=>O.value,canUpload:()=>F.value,uploadSizeLabel:()=>U.value,uploadProgressLabel:()=>h.value}),r({...a,upload:X,reset:I,removeUploadedFiles:T,removeQueuedFiles:Q,removeFile:J,pickFiles:m,addFiles:y,canAddFiles:O,canUpload:F,uploadSizeLabel:U,uploadProgressLabel:h}),()=>{const l=[B("div",{class:L.value},ee()),B("div",{class:"q-uploader__list scroll"},te()),A("uploader")];a.isBusy.value===!0&&l.push(B("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[B(Fe)]));const w={ref:k,class:D.value};return O.value===!0&&Object.assign(w,{onDragover:g,onDragleave:s}),B("div",w,l)}}const zt=()=>!0;function Ct(e){const r={};return e.forEach(n=>{r[n]=zt}),r}const Et=Ct(Ie),qt=({name:e,props:r,emits:n,injectPlugin:t})=>me({name:e,props:{...Ut,...r},emits:it(n)===!0?{...Et,...n}:[...Ie,...n],setup(i,{expose:o}){return Rt(t,o)}});function N(e){return typeof e=="function"?e:()=>e}const At="QUploader",Pt={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>e=>e.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},Tt=["factoryFailed","uploaded","failed","uploading"];function Ot({props:e,emit:r,helpers:n}){const t=q([]),i=q([]),o=q(0),f=z(()=>({url:N(e.url),method:N(e.method),headers:N(e.headers),formFields:N(e.formFields),fieldName:N(e.fieldName),withCredentials:N(e.withCredentials),sendRaw:N(e.sendRaw),batch:N(e.batch)})),d=z(()=>o.value>0),u=z(()=>i.value.length!==0);let c;function p(){t.value.forEach(a=>{a.abort()}),i.value.length!==0&&(c=!0)}function _(){const a=n.queuedFiles.value.slice(0);n.queuedFiles.value=[],f.value.batch(a)?k(a):a.forEach(m=>{k([m])})}function k(a){if(o.value++,typeof e.factory!="function"){v(a,{});return}const m=e.factory(a);if(!m)r("factoryFailed",new Error("QUploader: factory() does not return properly"),a),o.value--;else if(typeof m.catch=="function"&&typeof m.then=="function"){i.value.push(m);const y=g=>{n.isAlive()===!0&&(i.value=i.value.filter(s=>s!==m),i.value.length===0&&(c=!1),n.queuedFiles.value=n.queuedFiles.value.concat(a),a.forEach(s=>{n.updateFileStatus(s,"failed")}),r("factoryFailed",g,a),o.value--)};m.then(g=>{c===!0?y(new Error("Aborted")):n.isAlive()===!0&&(i.value=i.value.filter(s=>s!==m),v(a,g))}).catch(y)}else v(a,m||{})}function v(a,m){const y=new FormData,g=new XMLHttpRequest,s=(F,D)=>m[F]!==void 0?N(m[F])(D):f.value[F](D),R=s("url",a);if(!R){console.error("q-uploader: invalid or no URL specified"),o.value--;return}const A=s("formFields",a);A!==void 0&&A.forEach(F=>{y.append(F.name,F.value)});let P=0,b=0,x=0,S=0,h;g.upload.addEventListener("progress",F=>{if(h===!0)return;const D=Math.min(S,F.loaded);n.uploadedSize.value+=D-x,x=D;let L=x-b;for(let I=P;L>0&&I<a.length;I++){const T=a[I];if(L>T.size)L-=T.size,P++,b+=T.size,n.updateFileStatus(T,"uploading",T.size);else{n.updateFileStatus(T,"uploading",L);return}}},!1),g.onreadystatechange=()=>{g.readyState<4||(g.status&&g.status<400?(n.uploadedFiles.value=n.uploadedFiles.value.concat(a),a.forEach(F=>{n.updateFileStatus(F,"uploaded")}),r("uploaded",{files:a,xhr:g})):(h=!0,n.uploadedSize.value-=x,n.queuedFiles.value=n.queuedFiles.value.concat(a),a.forEach(F=>{n.updateFileStatus(F,"failed")}),r("failed",{files:a,xhr:g})),o.value--,t.value=t.value.filter(F=>F!==g))},g.open(s("method",a),R),s("withCredentials",a)===!0&&(g.withCredentials=!0);const U=s("headers",a);U!==void 0&&U.forEach(F=>{g.setRequestHeader(F.name,F.value)});const O=s("sendRaw",a);a.forEach(F=>{n.updateFileStatus(F,"uploading",0),O!==!0&&y.append(s("fieldName",F),F,F.name),F.xhr=g,F.__abort=()=>{g.abort()},S+=F.size}),r("uploading",{files:a,xhr:g}),t.value.push(g),O===!0?g.send(new Blob(a)):g.send(y)}return{isUploading:d,isBusy:u,abort:p,upload:_}}const jt={name:At,props:Pt,emits:Tt,injectPlugin:Ot},Dt=qt(jt);/*!
 * Compressor.js v1.2.1
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-02-28T14:09:41.732Z
 */function ze(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,t)}return n}function se(e){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?ze(Object(n),!0).forEach(function(t){Mt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Lt(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function Ce(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,Me(t.key),t)}}function It(e,r,n){return r&&Ce(e.prototype,r),n&&Ce(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Mt(e,r,n){return r=Me(r),r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function ue(){return ue=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},ue.apply(this,arguments)}function Nt(e,r){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var t=n.call(e,r||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function Me(e){var r=Nt(e,"string");return typeof r=="symbol"?r:String(r)}var Ne={exports:{}};(function(e){typeof window>"u"||function(r){var n=r.HTMLCanvasElement&&r.HTMLCanvasElement.prototype,t=r.Blob&&function(){try{return!!new Blob}catch{return!1}}(),i=t&&r.Uint8Array&&function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}}(),o=r.BlobBuilder||r.WebKitBlobBuilder||r.MozBlobBuilder||r.MSBlobBuilder,f=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,d=(t||o)&&r.atob&&r.ArrayBuffer&&r.Uint8Array&&function(u){var c,p,_,k,v,a,m,y,g;if(c=u.match(f),!c)throw new Error("invalid data URI");for(p=c[2]?c[1]:"text/plain"+(c[3]||";charset=US-ASCII"),_=!!c[4],k=u.slice(c[0].length),_?v=atob(k):v=decodeURIComponent(k),a=new ArrayBuffer(v.length),m=new Uint8Array(a),y=0;y<v.length;y+=1)m[y]=v.charCodeAt(y);return t?new Blob([i?m:a],{type:p}):(g=new o,g.append(a),g.getBlob(p))};r.HTMLCanvasElement&&!n.toBlob&&(n.mozGetAsFile?n.toBlob=function(u,c,p){var _=this;setTimeout(function(){p&&n.toDataURL&&d?u(d(_.toDataURL(c,p))):u(_.mozGetAsFile("blob",c))})}:n.toDataURL&&d&&(n.msToBlob?n.toBlob=function(u,c,p){var _=this;setTimeout(function(){(c&&c!=="image/png"||p)&&n.toDataURL&&d?u(d(_.toDataURL(c,p))):u(_.msToBlob(c))})}:n.toBlob=function(u,c,p){var _=this;setTimeout(function(){u(d(_.toDataURL(c,p)))})})),e.exports?e.exports=d:r.dataURLtoBlob=d}(window)})(Ne);var Ee=Ne.exports,Wt=function(r){return typeof Blob>"u"?!1:r instanceof Blob||Object.prototype.toString.call(r)==="[object Blob]"},qe={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},Ht=typeof window<"u"&&typeof window.document<"u",$=Ht?window:{},ce=function(r){return r>0&&r<1/0},$t=Array.prototype.slice;function ge(e){return Array.from?Array.from(e):$t.call(e)}var Qt=/^image\/.+$/;function he(e){return Qt.test(e)}function Vt(e){var r=he(e)?e.substr(6):"";return r==="jpeg"&&(r="jpg"),".".concat(r)}var We=String.fromCharCode;function Xt(e,r,n){var t="",i;for(n+=r,i=r;i<n;i+=1)t+=We(e.getUint8(i));return t}var Gt=$.btoa;function Ae(e,r){for(var n=[],t=8192,i=new Uint8Array(e);i.length>0;)n.push(We.apply(null,ge(i.subarray(0,t)))),i=i.subarray(t);return"data:".concat(r,";base64,").concat(Gt(n.join("")))}function Yt(e){var r=new DataView(e),n;try{var t,i,o;if(r.getUint8(0)===255&&r.getUint8(1)===216)for(var f=r.byteLength,d=2;d+1<f;){if(r.getUint8(d)===255&&r.getUint8(d+1)===225){i=d;break}d+=1}if(i){var u=i+4,c=i+10;if(Xt(r,u,4)==="Exif"){var p=r.getUint16(c);if(t=p===18761,(t||p===19789)&&r.getUint16(c+2,t)===42){var _=r.getUint32(c+4,t);_>=8&&(o=c+_)}}}if(o){var k=r.getUint16(o,t),v,a;for(a=0;a<k;a+=1)if(v=o+a*12+2,r.getUint16(v,t)===274){v+=8,n=r.getUint16(v,t),r.setUint16(v,1,t);break}}}catch{n=1}return n}function Kt(e){var r=0,n=1,t=1;switch(e){case 2:n=-1;break;case 3:r=-180;break;case 4:t=-1;break;case 5:r=90,t=-1;break;case 6:r=90;break;case 7:r=90,n=-1;break;case 8:r=-90;break}return{rotate:r,scaleX:n,scaleY:t}}var Jt=/\.\d*(?:0|9){12}\d*$/;function Pe(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Jt.test(e)?Math.round(e*r)/r:e}function re(e){var r=e.aspectRatio,n=e.height,t=e.width,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",o=ce(t),f=ce(n);if(o&&f){var d=n*r;(i==="contain"||i==="none")&&d>t||i==="cover"&&d<t?n=t/r:t=n*r}else o?n=t/r:f&&(t=n*r);return{width:t,height:n}}function Zt(e){for(var r=ge(new Uint8Array(e)),n=r.length,t=[],i=0;i+3<n;){var o=r[i],f=r[i+1];if(o===255&&f===218)break;if(o===255&&f===216)i+=2;else{var d=r[i+2]*256+r[i+3],u=i+d+2,c=r.slice(i,u);t.push(c),i=u}}return t.reduce(function(p,_){return _[0]===255&&_[1]===225?p.concat(_):p},[])}function ea(e,r){var n=ge(new Uint8Array(e));if(n[2]!==255||n[3]!==224)return e;var t=n[4]*256+n[5],i=[255,216].concat(r,n.slice(4+t));return new Uint8Array(i)}var ta=$.ArrayBuffer,fe=$.FileReader,V=$.URL||$.webkitURL,aa=/\.\w+$/,ra=$.Compressor,na=function(){function e(r,n){Lt(this,e),this.file=r,this.exif=[],this.image=new Image,this.options=se(se({},qe),n),this.aborted=!1,this.result=null,this.init()}return It(e,[{key:"init",value:function(){var n=this,t=this.file,i=this.options;if(!Wt(t)){this.fail(new Error("The first argument must be a File or Blob object."));return}var o=t.type;if(!he(o)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!V||!fe){this.fail(new Error("The current browser does not support image compression."));return}ta||(i.checkOrientation=!1,i.retainExif=!1);var f=o==="image/jpeg",d=f&&i.checkOrientation,u=f&&i.retainExif;if(V&&!d&&!u)this.load({url:V.createObjectURL(t)});else{var c=new fe;this.reader=c,c.onload=function(p){var _=p.target,k=_.result,v={},a=1;d&&(a=Yt(k),a>1&&ue(v,Kt(a))),u&&(n.exif=Zt(k)),d||u?!V||a>1?v.url=Ae(k,o):v.url=V.createObjectURL(t):v.url=k,n.load(v)},c.onabort=function(){n.fail(new Error("Aborted to read the image with FileReader."))},c.onerror=function(){n.fail(new Error("Failed to read the image with FileReader."))},c.onloadend=function(){n.reader=null},d||u?c.readAsArrayBuffer(t):c.readAsDataURL(t)}}},{key:"load",value:function(n){var t=this,i=this.file,o=this.image;o.onload=function(){t.draw(se(se({},n),{},{naturalWidth:o.naturalWidth,naturalHeight:o.naturalHeight}))},o.onabort=function(){t.fail(new Error("Aborted to load the image."))},o.onerror=function(){t.fail(new Error("Failed to load the image."))},$.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test($.navigator.userAgent)&&(o.crossOrigin="anonymous"),o.alt=i.name,o.src=n.url}},{key:"draw",value:function(n){var t=this,i=n.naturalWidth,o=n.naturalHeight,f=n.rotate,d=f===void 0?0:f,u=n.scaleX,c=u===void 0?1:u,p=n.scaleY,_=p===void 0?1:p,k=this.file,v=this.image,a=this.options,m=document.createElement("canvas"),y=m.getContext("2d"),g=Math.abs(d)%180===90,s=(a.resize==="contain"||a.resize==="cover")&&ce(a.width)&&ce(a.height),R=Math.max(a.maxWidth,0)||1/0,A=Math.max(a.maxHeight,0)||1/0,P=Math.max(a.minWidth,0)||0,b=Math.max(a.minHeight,0)||0,x=i/o,S=a.width,h=a.height;if(g){var U=[A,R];R=U[0],A=U[1];var O=[b,P];P=O[0],b=O[1];var F=[h,S];S=F[0],h=F[1]}s&&(x=S/h);var D=re({aspectRatio:x,width:R,height:A},"contain");R=D.width,A=D.height;var L=re({aspectRatio:x,width:P,height:b},"cover");if(P=L.width,b=L.height,s){var I=re({aspectRatio:x,width:S,height:h},a.resize);S=I.width,h=I.height}else{var T=re({aspectRatio:x,width:S,height:h}),Q=T.width;S=Q===void 0?i:Q;var K=T.height;h=K===void 0?o:K}S=Math.floor(Pe(Math.min(Math.max(S,P),R))),h=Math.floor(Pe(Math.min(Math.max(h,b),A)));var J=-S/2,ne=-h/2,ie=S,oe=h,X=[];if(s){var W=0,Z=0,ee=i,te=o,M=re({aspectRatio:x,width:i,height:o},{contain:"cover",cover:"contain"}[a.resize]);ee=M.width,te=M.height,W=(i-ee)/2,Z=(o-te)/2,X.push(W,Z,ee,te)}if(X.push(J,ne,ie,oe),g){var l=[h,S];S=l[0],h=l[1]}m.width=S,m.height=h,he(a.mimeType)||(a.mimeType=k.type);var w="transparent";k.size>a.convertSize&&a.convertTypes.indexOf(a.mimeType)>=0&&(a.mimeType="image/jpeg");var C=a.mimeType==="image/jpeg";if(C&&(w="#fff"),y.fillStyle=w,y.fillRect(0,0,S,h),a.beforeDraw&&a.beforeDraw.call(this,y,m),!this.aborted&&(y.save(),y.translate(S/2,h/2),y.rotate(d*Math.PI/180),y.scale(c,_),y.drawImage.apply(y,[v].concat(X)),y.restore(),a.drew&&a.drew.call(this,y,m),!this.aborted)){var j=function(H){if(!t.aborted){var be=function(ae){return t.done({naturalWidth:i,naturalHeight:o,result:ae})};if(H&&C&&a.retainExif&&t.exif&&t.exif.length>0){var ye=function(ae){return be(Ee(Ae(ea(ae,t.exif),a.mimeType)))};if(H.arrayBuffer)H.arrayBuffer().then(ye).catch(function(){t.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var G=new fe;t.reader=G,G.onload=function(de){var ae=de.target;ye(ae.result)},G.onabort=function(){t.fail(new Error("Aborted to read the compressed image with FileReader."))},G.onerror=function(){t.fail(new Error("Failed to read the compressed image with FileReader."))},G.onloadend=function(){t.reader=null},G.readAsArrayBuffer(H)}}else be(H)}};m.toBlob?m.toBlob(j,a.mimeType,a.quality):j(Ee(m.toDataURL(a.mimeType,a.quality)))}}},{key:"done",value:function(n){var t=n.naturalWidth,i=n.naturalHeight,o=n.result,f=this.file,d=this.image,u=this.options;if(V&&d.src.indexOf("blob:")===0&&V.revokeObjectURL(d.src),o)if(u.strict&&!u.retainExif&&o.size>f.size&&u.mimeType===f.type&&!(u.width>t||u.height>i||u.minWidth>t||u.minHeight>i||u.maxWidth<t||u.maxHeight<i))o=f;else{var c=new Date;o.lastModified=c.getTime(),o.lastModifiedDate=c,o.name=f.name,o.name&&o.type!==f.type&&(o.name=o.name.replace(aa,Vt(o.type)))}else o=f;this.result=o,u.success&&u.success.call(this,o)}},{key:"fail",value:function(n){var t=this.options;if(t.error)t.error.call(this,n);else throw n}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ra,e}},{key:"setDefaults",value:function(n){ue(qe,n)}}]),e}();const ia=ot({name:"uploaderIndex",__name:"uploader",props:{name:{type:String,default:"file"},respValue:{type:String,default:""},uploaderStyle:{type:Object,default:null},accept:{type:String,default:".jpg,.png,.gif,image/*"}},emits:["uploaded"],setup(e,{expose:r,emit:n}){const t=e,i=q(null),o=lt(),f="https://api.ainn.us",d=n,u=q(t.respValue),c=m=>{const y=m[0];y&&new na(y,{quality:.1,success(g){const s=new FormData;s.append("file",g,g.name),st(s).then(R=>{u.value=R[0],d("uploaded",u.value)})}})},p=()=>{i.value.pickFiles()},_=()=>{xe.show({spinner:ct,spinnerColor:"secondary",spinnerSize:50,message:"Some important process is in progress. Hang on..."})},k=()=>{xe.hide()},v=()=>{dt("negative",o.t("refuse"))};r({upload:c,uploaderPickFiles:p});const a={props:t,uploaderRef:i,$i18n:o,baseURL:f,emit:d,respValue:u,upload:c,uploaderPickFiles:p,uploaderStartFunc:_,uploaderFinishFunc:k,uploaderRejectedFunc:v,get imageSrc(){return ut}};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}}),oa=["onClick"],la={key:0,class:"text-center"},sa=["src"];function ua(e,r,n,t,i,o){return Se(),vt(Dt,{ref:"",flat:"",onAdded:t.upload,url:t.baseURL+"/upload","field-name":n.name,style:bt([n.uploaderStyle,{width:"100%",background:"transparent"}]),accept:n.accept,multiple:!1,onStart:t.uploaderStartFunc,onFinish:t.uploaderFinishFunc,onRejected:t.uploaderRejectedFunc},{header:Be(()=>[]),list:Be(f=>[ke("div",{onClick:f.pickFiles},[e.$slots.default?pt("",!0):(Se(),ht("div",la,[mt(_t),ke("img",{src:t.imageSrc(t.respValue),alt:""},null,8,sa)])),gt(e.$slots,"default")],8,oa)]),_:3},8,["url","field-name","style","accept"])}const fa=ft(ia,[["render",ua],["__file","uploader.vue"]]);export{_t as Q,fa as u};
