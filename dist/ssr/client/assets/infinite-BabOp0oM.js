import{h as l,c as A,bE as F,bF as O,a8 as R,r as d,a as B,w as _,a5 as U,a4 as G,T as W,E as D,g as Z,ak as J,b as K,ab as X,bG as x,as as q,ac as L,a7 as M,aa as Y,bH as k,a3 as $,n as ee,_ as te,s as I,u as ae,v as ie,b3 as ne,t as re,y as le,x as H,Z as se}from"./index-BGPSJsC7.js";const oe=[l("circle",{cx:"15",cy:"15",r:"15"},[l("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),l("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})]),l("circle",{cx:"60",cy:"15",r:"9","fill-opacity":".3"},[l("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),l("animate",{attributeName:"fill-opacity",from:".5",to:".5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})]),l("circle",{cx:"105",cy:"15",r:"15"},[l("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),l("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})])],ue=A({name:"QSpinnerDots",props:F,setup(t){const{cSize:c,classes:v}=O(t);return()=>l("svg",{class:v.value,fill:"currentColor",width:c.value,height:c.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg"},oe)}}),{passive:g}=X,ce=A({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:R,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(t,{slots:c,emit:v}){const a=d(!1),n=d(!0),o=d(null),m=d(null);let u=t.initialIndex,e,r;const h=B(()=>"q-infinite-scroll__loading"+(a.value===!0?"":" invisible"));function f(){if(t.disable===!0||a.value===!0||n.value===!1)return;const i=x(e),s=L(e),y=k(e);t.reverse===!1?Math.round(s+y+t.offset)>=Math.round(i)&&p():Math.round(s)<=t.offset&&p()}function p(){if(t.disable===!0||a.value===!0||n.value===!1)return;u++,a.value=!0;const i=x(e);v("load",u,s=>{n.value===!0&&(a.value=!1,q(()=>{if(t.reverse===!0){const y=x(e),j=L(e),z=y-i;M(e,j+z)}s===!0?P():o.value&&o.value.closest("body")&&r()}))})}function S(){u=0}function b(){n.value===!1&&(n.value=!0,e.addEventListener("scroll",r,g)),f()}function P(){n.value===!0&&(n.value=!1,a.value=!1,e.removeEventListener("scroll",r,g),r!==void 0&&r.cancel!==void 0&&r.cancel())}function N(){if(e&&n.value===!0&&e.removeEventListener("scroll",r,g),e=Y(o.value,t.scrollTarget),n.value===!0){if(e.addEventListener("scroll",r,g),t.reverse===!0){const i=x(e),s=k(e);M(e,i-s)}f()}}function Q(i){u=i}function T(i){i=parseInt(i,10);const s=r;r=i<=0?f:$(f,isNaN(i)===!0?100:i),e&&n.value===!0&&(s!==void 0&&e.removeEventListener("scroll",s,g),e.addEventListener("scroll",r,g))}function w(i){if(C.value===!0){if(m.value===null){i!==!0&&q(()=>{w(!0)});return}const s=`${a.value===!0?"un":""}pauseAnimations`;Array.from(m.value.getElementsByTagName("svg")).forEach(y=>{y[s]()})}}const C=B(()=>t.disable!==!0&&n.value===!0);_([a,C],()=>{w()}),_(()=>t.disable,i=>{i===!0?P():b()}),_(()=>t.reverse,()=>{a.value===!1&&n.value===!0&&f()}),_(()=>t.scrollTarget,N),_(()=>t.debounce,T);let E=!1;U(()=>{E!==!1&&e&&M(e,E)}),G(()=>{E=e?L(e):!1}),W(()=>{n.value===!0&&e.removeEventListener("scroll",r,g)}),D(()=>{T(t.debounce),N(),a.value===!1&&w()});const V=Z();return Object.assign(V.proxy,{poll:()=>{r!==void 0&&r()},trigger:p,stop:P,reset:S,resume:b,setIndex:Q,updateScrollTarget:N}),()=>{const i=J(c.default,[]);return C.value===!0&&i[t.reverse===!1?"push":"unshift"](l("div",{ref:m,class:h.value},K(c.loading))),l("div",{class:"q-infinite-scroll",ref:o},i)}}}),fe=ee({name:"infiniteIndex",__name:"infinite",props:{request:{required:!0,type:Function,default:()=>()=>{}},params:{required:!0,default:()=>({pagination:{descending:!0,page:1,rowsPerPage:10,sortBy:"createdAt"}})},height:{required:!0,type:Number,default:()=>1e3}},emits:["updatePage"],setup(t,{expose:c,emit:v}){const a=t,n=v,o=d(!0),m=d(!1),u=d([]),e=d(!1);D(()=>{setTimeout(()=>{e.value=!0},100)});const r=()=>{console.log("初始化"),u.value=[],o.value=!1,n("updatePage",1),h()},h=async(p,S)=>{console.log("加载",p);try{m.value=!0,a.request(a.params).then(b=>{b.items.length<a.params.pagination.rowsPerPage?(o.value=!0,u.value.push(...b.items)):(u.value.push(...b.items),n("updatePage",a.params.pagination.page+1)),m.value=!1})}finally{S&&S()}};c({loadMore:h,initData:r});const f={props:a,emit:n,disable:o,loading:m,itemList:u,ready:e,initData:r,loadMore:h};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}}),de={key:0,class:"row justify-center"};function ve(t,c,v,a,n,o){return a.ready?(I(),ae(ce,{key:0,onLoad:a.loadMore,offset:0,debounce:400,disable:a.disable,style:se({minHeight:v.height+"px"}),class:"q-pb-md"},{default:ie(()=>[ne(t.$slots,"default",{itemList:a.itemList}),a.loading?(I(),re("div",de,[le(ue,{color:"primary",size:"40px"})])):H("",!0)]),_:3},8,["disable","style"])):H("",!0)}const ge=te(fe,[["render",ve],["__file","infinite.vue"]]);export{ge as i};
